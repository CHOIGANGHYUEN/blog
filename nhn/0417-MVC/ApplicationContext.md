# [애플리케이션 컨텍스트](https://mangkyu.tistory.com/151)

## 애플리케이션 컨텍스트란
- BeanFactory : 빈의 생성과 관계 설정
  - IoC 컨테이너 이기도 함
  - 생성 및 관계설정 만으론 부족해, 빈 팩토리를 상속받아 확장한 애플리케이션 컨텍스트를 사용

<img src="../image/다운로드%20(6).png"/>

### 빈 요청시 처리 과정

1. ApplicationContext
   1. @Configuration이 붙은 클래스들을 설정 정보로 등록
   2.  @Bean이 붙은 메소드의 이름으로 빈 목록을 생성 
2. 클라이언트가 해당 빈을 요청
3. ApplicationContext는 자신의 빈 목록에서 요청한 이름이 있는지 찾는다.
4. ApplicationContext는 설정 클래스로부터 빈 생성을 요청하고, 생성된 빈을 돌려준다.
   
<img src="../image/다운로드%20(9).png"/>

- @Configuration이 붙으면 설정정보로 등록
- @Bean이 붙으면 메소드 이름으로 빈 목록 생성
- 클라이언트가 빈을 요청하면, 요청한 이름이 있는지 찾고, 해당 빈 생성 메소드를 호출해 객체를 생성하고 돌려줌
- Spring 내부의 Reflection Api를 이용해 빈 정의에 나오는 클래스 이름을 이용하거나, 또는 빈 팩토리를 통해 빈을 생성

### 애플리케이션 컨텍스트의 장점
1. 클라이언트는 @Configuration이 붙은 구체적인 팩토리 클래스를 알 필요가 없다.
2. 애플리케이션 컨텍스트는 종합 IoC서비스를 제공해준다.
3. 애플리케이션 컨텍스트를 통해 다양한 빈 검색 방법을 제공할 수 있다.

#### 1. 클라이언트는 @Configuration이 붙은 구체적인 팩토리 클래스를 알 필요가 없다.
- 애플리케이션이 발전하면, 팩토리 클래스가 계속 증가할 것
  - 애플리케이션 컨텍스트가 없다면, 클라이언트는 원하는 객체를 가져오기 위해, 어떤 팩토리 클래스에 접근해야하는 지 알아야함
  - 애플리케이션 컨텍스트를 사용하면, 팩토리가 아무리 많아져도 이에 직접 접근할 필요가 없어져, 일관된 방식으로 원하는 빈을 가져올 수 있다.

#### 2. 애플리케이션 컨텍스트는 종합 IoC 서비스를 제공해준다.
- 애플리케이션 컨텍스트는 객체 생성과 관계설정이 다가 아니다.
- 객체가 만들어지는 방식과 시점 및 전략 등을 다르게 가질 수 있고,
- 후처리나 정보의 조합 인터셉트 등과 같은 다양한 기능이 존재한다

#### 3 애플리케이션 컨텍스트를 통해 다양한 빈 검색 방법을 제공할 수 있다.
- 애플리케이션 컨텍스트는 빈 목록을 관리
  - 빈 이름, 타입, 어노테이션 설정 등으로 빈을 찾을 수 있다.
- 빈 검색 방식을 의존성 검색(dependency lookup)이라 불린다.

>Dependency Lookup : 필요한 객체를 생성하고 클라이언트는 컨테이너가 생성한 객체를 Lookup(검색)하여 사용하는 방식(실제 개발에서는 사용하지 않음)

>Dependency Injection : 객체 사이의 의존관계를 스프링 설정 파일에 등록된 정보를 바탕으로 컨테이너가 자동으로 처리해주는 방식(실제 개발에서 사용 함)

---

## 스프링의 싱글톤

### 스프링에서 싱글톤을 사용하는 이유
- 애플리케이션 컨텍스트에 의해 등록된 빈은 기본적으로 싱글톤
  - 스프링에 여러번 빈을 요청하더라도, 매번 동일한 객체를 돌려줌
  - 대규모 트래픽을 처리 할 수 있도록 하기 위함
- 대규모 엔터프라이즈 환경에서 요청을 처리 할 수 있도록 고안
  - 스프링의 최초 설계 원칙
  - Controller, Service, Repository로 나뉨
- 다만 지나치게 많은 빈 생성을 해결하기 위해 빈을 싱글톤 스코프로 관리해 1개의 요청이 왔을 때 여러 쓰레드가 빈을 공유해 처리

### 스프링 싱글톤의 장점
#### [기존] 자바의 싱글톤
- private 생성자를 갖고 있어 상속이 불가능
- 테스트가 어려움
- 서버 환경에서는 싱글톤이 1개만 생성됨을 보장 불가능
- 전역 상태를 만들 수 있기에 객체지향적이지 못함

#### 스프링의 싱글톤
- 싱글톤 레지스트리
  - 직접 싱글톤 형태의 오브젝트를 만들고, 관리하는 기능
  - 장점 
    - static 메소드나 private 생성자를 사용하지 않아 객체 지향적 개발
    - 테스트 하기 편함
- 스프링 컨테이너는 싱글톤을 생성, 관리, 공급하는 컨테이너
  